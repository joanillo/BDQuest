solució per a ERROR 1698 (28000): Access denied for user 'root'@'localhost'

ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '*****';
flush privileges

Versió 1
==============
/*
bases de dades de treball
bd (id_bd, bd, num_taules)
#proposta d'exercicis sobre la base de dades de treball
bd_questio (id_bd_questio, id_bd, questio, nivell, solucio)

usuari (id_usuari, nom, cognoms, curs)
quest (id_quest, dia, id_bd)
quest_detail (id_quest_detall, id_quest, id_bd_questio, num)
nota (id_nota, id_quest, id_usuari, nota)
*/


# CREATE DATABASE bdquest CHARACTER SET utf8 COLLATE utf8_general_ci;
# use bdquest

DROP TABLE IF EXISTS bd_questio;
DROP TABLE IF EXISTS bd;
DROP TABLE IF EXISTS usuari;

CREATE TABLE bd (
id_bd smallint AUTO_INCREMENT PRIMARY KEY,
bd VARCHAR(50) NOT NULL,
num_taules smallint
);

CREATE TABLE bd_questio (
id_bd_questio smallint AUTO_INCREMENT PRIMARY KEY,
id_bd smallint references BD,
questio VARCHAR(255) NOT NULL,
nivell smallint CHECK (nivell IN (1,2,3,4,5)),
solucio text
);

CREATE TABLE usuari (
id_usuari smallint AUTO_INCREMENT PRIMARY KEY,
nom VARCHAR(255) NOT NULL,
cognoms VARCHAR(255) NOT NULL,
curs VARCHAR(5) NOT NULL
);

INSERT INTO bd VALUES (1,'municipis',3);
INSERT INTO bd_questio VALUES (1, 1, 'Llista de províncies (id i provincia), ordentat per id', 1, 'select id_prov, provincia from provincies order by id_prov;');
INSERT INTO bd_questio VALUES (2, 1, 'Els 5 primers municipis de Càceres (només el nom del municipi), per ordre alfabètic. NOTA: no has de saber quin és el id de Cáceres.', 1, 'select municipi from municipis m, provincies p where m.id_prov=p.id_prov and provincia=''Cáceres'' order by municipi limit 5>;');

====
# CREATE DATABASE municipis CHARACTER SET utf8 COLLATE utf8_general_ci;

sakila
municipis



CREATE DATABASE municipis DEFAULT CHARACTER SET utf8;

Importació de les dades
$ mysql -u root -p municipis -f < dades_municipis_mysql.sql > /home/joan/control_errors.log 2>&1

municipis de Cáceres
Des de dins del mysql (sense capçalera i sense warnings):
mysql> select municipi from municipis m, provincies p where m.id_prov=p.id_prov and provincia='Cáceres'
$ mysql -u root -pShe4aiVa municipis -N -s -e "select municipi from municipis m, provincies p where m.id_prov=p.id_prov and provincia='Cáceres' order by municipi limit 5" 2>/dev/null

selects simples
selects complexes
subconsultes
group by


====
2 modes
-pràctica
-ex autoavaluació
-examen
===

utf8 a fpdf:
https://stackoverflow.com/questions/6334134/fpdf-utf-8-encoding-how-to

La solució més ràpida i fàcil és afegir la línia:
$txt = iconv('utf-8', 'cp1252', $txt); //canvi
en el fitxer fpdf.php:

	if($txt!=='')
	{
		if(!isset($this->CurrentFont))
			$this->Error('No font has been set');
		$txt = iconv('utf-8', 'cp1252', $txt); //canvi
		if($align=='R')
			$dx = $w-$this->cMargin-$this->GetStringWidth($txt);
		elseif($align=='C')
			$dx = ($w-$this->GetStringWidth($txt))/2;
		else

== HABILITAR CONNEXIONS REMOTES DEL MYSQL DE OVH ==
Bind-address            = 127.0.0.1

$ service mysql restart; (important!)

CREATE USER 'bdquest'@'%' IDENTIFIED BY 'keiL2lai';
GRANT ALL ON bdquest.* TO 'bdquest'@'%';
flush privileges;


mysql> SELECT User, Host FROM mysql.user;
mysql -h 51.210.179.7 -u bdquest -pkeiL2lai bdquest
mysql -h vps-f5d83567.vps.ovh.net -u bdquest -pkeiL2lai bdquest

Hem d'accedir al firewall i permetre les connexions remotes pel port TCP/3306:
OVH Control Panel:
*https://www.ovh.com/auth/?action=gotomanager&from=https://www.ovh.co.uk/&ovhSubsidiary=GB
*https://docs.ovh.com/gb/en/dedicated/firewall-network/

Anem al dashboard > IP
Veig que el firewall està desactivat. S'ha de crear un firewall, i configurar-lo

Afegir una regla -> TCP 3306 permetre connexions remotes

Per mirar si el port remot està obert podem fer des del portàtil:ç
nc -zv 51.210.179.7 3306
Connection to 51.210.179.7 3306 port [tcp/mysql] succeeded!


Per exemple els ports 80 i 22 estan oberts per defecte: (en el portàtil)

$ nc -zv 51.210.179.7 80
Connection to 51.210.179.7 80 port [tcp/http] succeeded!

$ nc -zv vps-f5d83567.vps.ovh.net 3306
Connection to vps-f5d83567.vps.ovh.net 3306 port [tcp/mysql] succeeded!

$ nc -zv 51.210.179.7 22
Connection to 51.210.179.7 22 port [tcp/ssh] succeeded!

netstat -plant|grep ":3306"|grep "LISTEN"

En el servidor:
# netstat -plant|grep ":3306"|grep "LISTEN"
tcp6       0      0 :::33060                :::*                    LISTEN      3408250/mysqld      
tcp6       0      0 :::3306                 :::*                    LISTEN


Finalment ja funciona:
$ mysql -h 51.210.179.7 -u bdquest -pkeiL2lai bdquest;
$ mysql -h vps-f5d83567.vps.ovh.net -u bdquest -pkeiL2lai bdquest;

Per tant resumint s'han de fer 3 coses:

1. habilitar les connexions entrants en el mysql
2. que l'usuari bdquest pugui realitzar connexions remotes
3. que el servidor remot accepti connexions pel port 3306 (habilitar una regla del firewall)

===
Nota 22/12/2021
El qüestionari 'langtrainer: insert, update, delete', compte! perquè els alumnes estan treballant amb la base de dades real.
Si hi hagués algun problema, es podria malmetre la bd. 

Les noves dades que tinc introduïdes són:
1450. stiple: puntejar

Si introdueixo noves dades, per tal de què funcionin les preguntes 2 i 3 s'haurà de canviar el index.
